<nav
  class="sticky top-0 z-50 theme-navbar backdrop-blur-xl border-b">
  <div class="max-w-full mx-auto px-4 sm:px-6 lg:px-4">
    <div class="flex h-16 items-center justify-between">

      <!-- Search Bar -->
      <div class="flex-1 flex max-w-2xl ml-12 lg:ml-48">
        <div class="relative w-full max-w-md group">
          <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
            <i
              class="fa-solid fa-magnifying-glass theme-search-icon text-sm transition-colors duration-200"></i>
          </div>
          <input type="text" class="block w-full pl-10 pr-3 py-2 border-none rounded-xl leading-5 theme-search-input
                   transition-all duration-200 ease-in-out sm:text-sm" placeholder="Search..." />
        </div>
      </div>

      <!-- Right Side Actions -->
      <div class="flex items-center gap-6">

        <!-- User Profile -->
        @if (currentUser()) {
        <div class="hidden md:flex items-center gap-3 pl-2">
          <div class="relative" (click)="preventMenuClose($event)">
            <button type="button" class="business-selector-btn" (click)="toggleBusinessMenu($event)">
              <span class="business-selector-copy">
                <span class="business-selector-title">{{ selectedBusinessLabel() }}</span>
                <span class="business-selector-subtitle">{{ selectedBusinessType() }}</span>
              </span>
              <i class="fa-solid fa-chevron-down text-[11px] text-slate-500"></i>
            </button>

            @if (isBusinessMenuOpen()) {
            <div class="business-menu-panel">
              <button type="button" class="business-option" [class.business-option--active]="selectedBusinessId() === 'default'"
                (click)="selectBusiness('default', $event)">
                <span class="business-option-avatar business-option-avatar--default">
                  <i class="fa-regular fa-building text-[12px]"></i>
                </span>
                <span class="business-option-copy">
                  <span class="business-option-title">Default</span>
                  <span class="business-option-subtitle">No business selected</span>
                </span>
                @if (selectedBusinessId() === 'default') {
                <i class="fa-solid fa-check text-xs text-sky-500"></i>
                }
              </button>

              @for (business of businesses(); track business.id) {
              <button type="button" class="business-option" [class.business-option--active]="selectedBusinessId() === business.id"
                (click)="selectBusiness(business.id, $event)">
                <span class="business-option-avatar">
                  @if (business.logo_path) {
                  <img [src]="business.logo_path" [alt]="business.name" class="business-option-logo" />
                  } @else {
                  <span class="business-option-initial">{{ businessInitial(business.name) }}</span>
                  }
                </span>
                <span class="business-option-copy">
                  <span class="business-option-title">{{ business.name }}</span>
                  <span class="business-option-subtitle">{{ business.type }}</span>
                </span>
                @if (selectedBusinessId() === business.id) {
                <i class="fa-solid fa-check text-xs text-sky-500"></i>
                }
              </button>
              }

              <div class="business-menu-divider"></div>

              <button type="button" class="business-add-btn" (click)="openAddBusinessDrawer($event)">
                <i class="fa-solid fa-plus"></i>
                Add Business
              </button>
            </div>
            }
          </div>

          <button class="relative group cursor-pointer focus:outline-none">
            <div
              class="relative h-10 w-10 rounded-full overflow-hidden ring-2 ring-transparent theme-avatar-ring transition-all duration-200">
              <img [src]="currentUser()?.avatar || 'assets/default-avatar.png'" [alt]="currentUser()?.name"
                class="h-full w-full object-cover" />
            </div>
          </button>
        </div>
        } @else {
        <div class="hidden md:flex items-center gap-3">
          <button routerLink="/login"
            class="px-5 py-2 text-sm font-medium rounded-full theme-primary-btn shadow-sm transition-all transform active:scale-95">
            Get started
          </button>
        </div>
        }

        <!-- Mobile Menu Button -->
        <button type="button"
          class="md:hidden inline-flex items-center justify-center p-2 rounded-md theme-mobile-trigger focus:ring-2 focus:ring-inset"
          onclick="document.getElementById('mobile-menu').classList.toggle('hidden')">
          <span class="sr-only">Open main menu</span>
          <i class="fa-solid fa-bars text-xl"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Mobile Menu -->
  <div id="mobile-menu" class="hidden md:hidden border-t theme-mobile-menu backdrop-blur-xl">
    <div class="pt-4 pb-4 px-4 space-y-4">
      @if (currentUser()) {
      <div class="space-y-3">
        <div class="flex items-center justify-between rounded-xl border border-slate-200/70 bg-white/80 px-3 py-2">
          <div>
            <p class="text-[11px] font-semibold uppercase tracking-[0.12em] text-slate-500">Current Workspace</p>
            <p class="text-sm font-semibold text-slate-800">{{ selectedBusinessLabel() }}</p>
          </div>
          <button type="button" class="text-xs font-semibold text-sky-600" (click)="openAddBusinessDrawer($event)">
            Add
          </button>
        </div>
        <div class="flex items-center px-2">
          <div class="flex-shrink-0">
          <img [src]="currentUser()?.avatar || 'assets/default-avatar.png'" class="h-10 w-10 rounded-full" alt="" />
          </div>
        </div>
      </div>
      } @else {
      <div class="space-y-2">
        <button routerLink="/login"
          class="w-full py-2.5 text-sm font-medium rounded-lg theme-primary-btn">
          Get started
        </button>
      </div>
      }
    </div>
  </div>
</nav>

<div class="business-drawer-shell" [class.business-drawer-shell--open]="isAddBusinessDrawerOpen()">
  <div class="business-drawer-backdrop" (click)="closeAddBusinessDrawer()"></div>
  <aside class="business-drawer" (click)="preventMenuClose($event)">
    <div class="business-drawer-header">
      <div>
        <p class="business-drawer-kicker">Workspace Setup</p>
        <h3 class="business-drawer-title">Add Business</h3>
      </div>
      <button type="button" class="business-drawer-close" (click)="closeAddBusinessDrawer()">
        <i class="fa-solid fa-xmark"></i>
      </button>
    </div>

    <form [formGroup]="addBusinessForm" (ngSubmit)="submitAddBusiness()" class="business-form">
      <label class="business-form-field">
        <span>Business Name</span>
        <input type="text" formControlName="name" placeholder="Enter business name" />
      </label>

      <label class="business-form-field">
        <span>Business Type</span>
        <select formControlName="type">
          @for (type of businessTypes; track type) {
          <option [value]="type">{{ type }}</option>
          }
        </select>
      </label>

      <label class="business-form-field">
        <span>Status</span>
        <select formControlName="status">
          <option [value]="1">Active</option>
          <option [value]="0">Inactive</option>
        </select>
      </label>

      <div class="business-form-field">
        <span>Logo</span>
        <input #logoInput type="file" accept="image/*" class="hidden" (change)="onLogoInputChange($event)" />
        <div class="business-logo-dropzone" [class.business-logo-dropzone--dragover]="isLogoDragOver()"
          (click)="logoInput.click()" (dragover)="onLogoDragOver($event)" (dragleave)="onLogoDragLeave($event)"
          (drop)="onLogoDrop($event)">
          @if (logoPreview()) {
          <img [src]="logoPreview()!" alt="Logo preview" class="business-logo-preview" />
          <button type="button" class="business-logo-remove" (click)="removeLogo($event)">
            Remove
          </button>
          } @else {
          <div class="business-logo-empty">
            <i class="fa-regular fa-image"></i>
            <p>Drop logo here or click to browse</p>
            <span>PNG, JPG, WEBP up to 5MB</span>
          </div>
          }
        </div>
      </div>

      @if (businessErrorMessage()) {
      <p class="business-form-error">{{ businessErrorMessage() }}</p>
      }

      <div class="business-form-actions">
        <button type="button" class="business-cancel-btn" (click)="closeAddBusinessDrawer()">Cancel</button>
        <button type="submit" [disabled]="addBusinessForm.invalid || isSubmittingBusiness()" class="business-submit-btn">
          @if (isSubmittingBusiness()) {
          Saving...
          } @else {
          Save Business
          }
        </button>
      </div>
    </form>
  </aside>
</div>
